<UserControl
    x:Class="DBADash.ModernUI.Controls.DatabaseMetricsWidget"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:lvc="using:LiveChartsCore.SkiaSharpView.WinUI"
    xmlns:lottie="using:LottieWinUI">

    <Border Style="{StaticResource CardBorderStyle}">
        <Grid Padding="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Margin="0,0,0,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="{x:Bind IconGlyph}" 
                             FontSize="20" 
                             Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                    <TextBlock Text="{x:Bind Title}" 
                              Style="{StaticResource SubtitleTextBlockStyle}"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="4">
                    <!-- Loading Animation -->
                    <lottie:LottieAnimationView x:Name="LoadingAnimation"
                                               Source="ms-appx:///Assets/Animations/loading.json"
                                               Width="20" Height="20"
                                               Visibility="{x:Bind IsLoading, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                                               AutoPlay="True"/>
                    
                    <!-- Status Indicator -->
                    <Ellipse Width="8" Height="8" 
                            Fill="{x:Bind Status, Mode=OneWay, Converter={StaticResource StatusToBrushConverter}}"
                            Visibility="{x:Bind IsLoading, Mode=OneWay, Converter={StaticResource InvertedBoolToVisibilityConverter}}"/>
                    
                    <!-- Refresh Button -->
                    <Button Width="24" Height="24" 
                           Padding="0" 
                           Background="Transparent"
                           BorderThickness="0"
                           Command="{x:Bind RefreshCommand}"
                           ToolTipService.ToolTip="Refresh">
                        <FontIcon Glyph="&#xE72C;" FontSize="12"/>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- Content Area -->
            <Grid Grid.Row="1">
                <!-- Main Metric Display -->
                <StackPanel x:Name="MetricDisplay" 
                           HorizontalAlignment="Center" 
                           VerticalAlignment="Center"
                           Spacing="4"
                           Visibility="{x:Bind ShowChart, Mode=OneWay, Converter={StaticResource InvertedBoolToVisibilityConverter}}">
                    
                    <TextBlock Text="{x:Bind MainValue, Mode=OneWay}" 
                              Style="{StaticResource DisplayTextBlockStyle}"
                              HorizontalAlignment="Center"
                              Foreground="{x:Bind ValueColor, Mode=OneWay}"/>
                              
                    <TextBlock Text="{x:Bind MainUnit, Mode=OneWay}" 
                              Style="{StaticResource BodyTextBlockStyle}"
                              HorizontalAlignment="Center"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                              
                    <TextBlock Text="{x:Bind TrendText, Mode=OneWay}" 
                              Style="{StaticResource CaptionTextBlockStyle}"
                              HorizontalAlignment="Center"
                              Foreground="{x:Bind TrendColor, Mode=OneWay}"/>
                </StackPanel>

                <!-- Mini Chart -->
                <lvc:CartesianChart x:Name="MiniChart" 
                                   Height="80"
                                   Series="{x:Bind ChartSeries, Mode=OneWay}"
                                   Visibility="{x:Bind ShowChart, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"/>
            </Grid>

            <!-- Footer -->
            <Grid Grid.Row="2" Margin="0,12,0,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" 
                          Text="{x:Bind LastUpdated, Mode=OneWay, Converter={StaticResource RelativeTimeConverter}}" 
                          Style="{StaticResource CaptionTextBlockStyle}"
                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
                    <!-- Alert Indicator -->
                    <Border Background="{x:Bind AlertSeverity, Mode=OneWay, Converter={StaticResource SeverityToBackgroundConverter}}"
                           CornerRadius="8"
                           Padding="6,2"
                           Visibility="{x:Bind HasAlert, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                        <TextBlock Text="{x:Bind AlertCount, Mode=OneWay}" 
                                  Style="{StaticResource CaptionTextBlockStyle}"
                                  Foreground="White"
                                  FontWeight="SemiBold"/>
                    </Border>
                    
                    <!-- Threshold Indicator -->
                    <TextBlock Text="{x:Bind ThresholdStatus, Mode=OneWay}" 
                              Style="{StaticResource CaptionTextBlockStyle}"
                              Foreground="{x:Bind ThresholdColor, Mode=OneWay}"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</UserControl>
