<Window
    x:Class="DBADash.ModernUI.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:DBADash.ModernUI.Controls"
    xmlns:viewmodels="using:DBADash.ModernUI.ViewModels">

    <Grid>
        <NavigationView
            x:Name="MainNavigationView"
            Style="{StaticResource DBADashNavigationViewStyle}"
            SelectionChanged="NavigationView_SelectionChanged"
            BackRequested="NavigationView_BackRequested"
            IsBackEnabled="{x:Bind ViewModel.NavigationService.CanGoBack, Mode=OneWay}"
            Header="{x:Bind ViewModel.CurrentPageTitle, Mode=OneWay}">

            <!-- Navigation Menu Items -->
            <NavigationView.MenuItems>
                <!-- Summary -->
                <NavigationViewItem
                    Content="Summary"
                    Tag="Summary"
                    Icon="Home">
                    <NavigationViewItem.InfoBadge>
                        <InfoBadge 
                            Value="{x:Bind ViewModel.SummaryAlertCount, Mode=OneWay}"
                            Visibility="{x:Bind ViewModel.HasSummaryAlerts, Mode=OneWay}" />
                    </NavigationViewItem.InfoBadge>
                </NavigationViewItem>

                <!-- Instances -->
                <NavigationViewItem
                    Content="Instances"
                    Tag="Instances"
                    Icon="Server" />

                <!-- Performance -->
                <NavigationViewItem
                    Content="Performance"
                    Tag="Performance"
                    Icon="SpeedHigh" />

                <!-- Alerts -->
                <NavigationViewItem
                    Content="Alerts"
                    Tag="Alerts"
                    Icon="Important">
                    <NavigationViewItem.InfoBadge>
                        <InfoBadge 
                            Value="{x:Bind ViewModel.ActiveAlertCount, Mode=OneWay}"
                            Visibility="{x:Bind ViewModel.HasActiveAlerts, Mode=OneWay}" />
                    </NavigationViewItem.InfoBadge>
                </NavigationViewItem>

                <!-- Jobs -->
                <NavigationViewItem
                    Content="Jobs"
                    Tag="Jobs"
                    Icon="PlaySolid" />

                <!-- Backups -->
                <NavigationViewItem
                    Content="Backups"
                    Tag="Backups"
                    Icon="BackupRestore" />

                <!-- Queries -->
                <NavigationViewItem
                    Content="Queries"
                    Tag="Queries"
                    Icon="Code" />

                <!-- Separator -->
                <NavigationViewItemSeparator />

                <!-- Reports -->
                <NavigationViewItem
                    Content="Reports"
                    Tag="Reports"
                    Icon="Document" />

                <!-- Configuration -->
                <NavigationViewItem
                    Content="Configuration"
                    Tag="Configuration"
                    Icon="Setting" />
            </NavigationView.MenuItems>

            <!-- Footer Menu Items -->
            <NavigationView.FooterMenuItems>
                <NavigationViewItem
                    Content="Help"
                    Tag="Help"
                    Icon="Help" />
                <NavigationViewItem
                    Content="About"
                    Tag="About"
                    Icon="Info" />
            </NavigationView.FooterMenuItems>

            <!-- Content Frame -->
            <Frame x:Name="ContentFrame" />

            <!-- Header Content -->
            <NavigationView.Header>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Page Title -->
                    <TextBlock
                        Grid.Column="0"
                        Text="{x:Bind ViewModel.CurrentPageTitle, Mode=OneWay}"
                        Style="{StaticResource DBADashTitleTextStyle}"
                        VerticalAlignment="Center" />

                    <!-- Header Actions -->
                    <StackPanel
                        Grid.Column="1"
                        Orientation="Horizontal"
                        Spacing="8"
                        VerticalAlignment="Center">

                        <!-- Connection Status -->
                        <controls:ConnectionStatusControl
                            DataContext="{x:Bind ViewModel.ConnectionStatus, Mode=OneWay}" />

                        <!-- Refresh Button -->
                        <Button
                            Command="{x:Bind ViewModel.RefreshCommand}"
                            ToolTipService.ToolTip="Refresh Data">
                            <FontIcon Glyph="&#xE72C;" />
                        </Button>

                        <!-- Search -->
                        <AutoSuggestBox
                            x:Name="SearchBox"
                            PlaceholderText="Search instances, databases..."
                            QueryIcon="Find"
                            Width="300"
                            Text="{x:Bind ViewModel.SearchText, Mode=TwoWay}"
                            SuggestionChosen="{x:Bind ViewModel.OnSearchSuggestionChosen}"
                            QuerySubmitted="{x:Bind ViewModel.OnSearchSubmitted}" />

                        <!-- Theme Toggle -->
                        <ToggleButton
                            IsChecked="{x:Bind ViewModel.IsDarkTheme, Mode=TwoWay}"
                            ToolTipService.ToolTip="Toggle Theme">
                            <FontIcon Glyph="&#xE793;" />
                        </ToggleButton>

                        <!-- Settings -->
                        <Button
                            Command="{x:Bind ViewModel.OpenSettingsCommand}"
                            ToolTipService.ToolTip="Settings">
                            <FontIcon Glyph="&#xE713;" />
                        </Button>
                    </StackPanel>
                </Grid>
            </NavigationView.Header>

        </NavigationView>

        <!-- Loading Overlay -->
        <Border
            Background="{ThemeResource SystemControlAcrylicWindowBrush}"
            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay}">
            <StackPanel
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Spacing="16">
                <ProgressRing IsActive="True" Width="48" Height="48" />
                <TextBlock
                    Text="{x:Bind ViewModel.LoadingMessage, Mode=OneWay}"
                    Style="{StaticResource DBADashBodyTextStyle}"
                    HorizontalAlignment="Center" />
            </StackPanel>
        </Border>

        <!-- Status Bar -->
        <Grid
            VerticalAlignment="Bottom"
            Background="{StaticResource DBADashSurfaceBrush}"
            Height="32">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- Status Message -->
            <TextBlock
                Grid.Column="0"
                Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}"
                Style="{StaticResource DBADashCaptionTextStyle}"
                VerticalAlignment="Center"
                Margin="16,0" />

            <!-- Connection Info -->
            <TextBlock
                Grid.Column="1"
                Text="{x:Bind ViewModel.ConnectionInfo, Mode=OneWay}"
                Style="{StaticResource DBADashCaptionTextStyle}"
                VerticalAlignment="Center"
                Margin="8,0" />

            <!-- Last Updated -->
            <TextBlock
                Grid.Column="2"
                Text="{x:Bind ViewModel.LastUpdated, Mode=OneWay}"
                Style="{StaticResource DBADashCaptionTextStyle}"
                VerticalAlignment="Center"
                Margin="16,0" />
        </Grid>
    </Grid>
</Window>
